<script src="{{ 'mega-menu.js' | asset_url }}" defer></script>

{% liquid
  assign image_size = image_size | default: 300
  assign default_img = ''
  assign default_title = ''
%}

<div class="mega-menu" role="region" aria-label="{{ link.title | escape }}">
  <div class="mega-menu__panel">
    <!-- LEFT: Navigation links -->
    <nav class="mega-menu__left" aria-label="{{ link.title | escape }} sub-links">
      <ul class="mega-menu__nav" role="list">
        {%- for child in link.links -%}
          {%- liquid
            assign img_url = ''
            if child.type == 'collection_link' and child.object and child.object.image
              assign img_url = child.object.image | image_url: width: image_size
            endif

            if default_img == '' and img_url != ''
              assign default_img = img_url
              assign default_title = child.title | escape
            endif
          -%}
          {%- if child.object.all_products_count > 0 -%}
            <li class="mega-menu__nav-item{% if forloop.first %} is-active{% endif %}">
              <a
                href="{{ child.url }}"
                class="mega-menu__nav-link"
                data-image="{{ img_url }}"
                data-title="{{ child.title | escape }}"
              >
                {{ child.title | escape }}
              </a>
            </li>
          {%- endif -%}
        {%- endfor -%}
      </ul>
    </nav>

    <!-- RIGHT: Dynamic image -->
    <div class="mega-menu__right">
      <div class="mega-menu__image-box">
        {% if default_img != '' %}
          <img
            width=""
            height=""
            class="mega-menu__display-image"
            src="{{ default_img }}"
            alt="{{ default_title | escape }}"
            loading="lazy"
          >
          {% comment %} <div class="mega-menu__display-caption">{{ default_title }}</div> {% endcomment %}
        {% else %}
          <div class="mega-menu__placeholder" role="img" aria-label="No image available">No image available</div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
